<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>TEQRA OS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="bg-overlay"></div>

    <div class="app-container">
        <header>
            <div class="brand-box">
                <h1 class="logo">TEQRA<span class="dot">.</span>STORE</h1>
            </div>
            <button id="admin-toggle" class="cyber-btn-small" style="display: none;" onclick="toggleAdminPanel()">
                <i class="fas fa-terminal"></i> CMD
            </button>
        </header>

        <div id="admin-panel" class="control-panel">
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="switchTab('add')">–î–û–î–ê–¢–ò</button>
                <button class="tab-btn" onclick="switchTab('orders')">–ó–ê–ú–û–í–õ–ï–ù–ù–Ø</button>
            </div>

            <div id="tab-add" class="tab-content active">
                <div class="control-grid">
                    <div class="input-group full-width"><label>–ú–æ–¥–µ–ª—å –ø—Ä–∏—Å—Ç—Ä–æ—é</label><input type="text" id="inp-title" placeholder="–ù–∞–ø—Ä: MSI GF63 Thin"></div>
                    <div class="input-group"><label>–¶—ñ–Ω–∞ ‚Ç¥</label><input type="number" id="inp-price" placeholder="18999"></div>
                    <div class="input-group">
                        <label>–ö–ª–∞—Å</label>
                        <select id="inp-type">
                            <option value="gaming">üöÄ GAMING</option>
                            <option value="work">üíº BUSINESS</option>
                            <option value="ultrabook">üõ∏ ULTRA</option>
                        </select>
                    </div>
                    <div class="input-group full-width"><label>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label><input type="text" id="inp-specs" placeholder="i7 / RTX 3060 / 16GB"></div>
                    
                    <div class="input-group full-width">
                        <input type="file" id="inp-file" accept="image/*" style="display: none;">
                        <button class="cyber-btn-glitch" onclick="document.getElementById('inp-file').click()">
                            <i class="fas fa-camera"></i> –û–ë–†–ê–¢–ò –§–û–¢–û –ó –ì–ê–õ–ï–†–ï–á
                        </button>
                        <div id="upload-status" class="status-msg"></div>
                        <input type="hidden" id="inp-img-url">
                    </div>
                </div>
                <button class="cyber-btn-glitch main-action" id="add-btn" onclick="addProduct()" disabled>–ê–ö–¢–ò–í–£–í–ê–¢–ò –õ–û–¢</button>
            </div>

            <div id="tab-orders" class="tab-content">
                <div id="orders-list" class="orders-container"></div>
            </div>
        </div>

        <div id="order-form" class="order-overlay" style="display:none;">
            <div class="order-card fade-in">
                <div id="order-step-1">
                    <h3>–û–§–û–†–ú–õ–ï–ù–ù–Ø</h3>
                    <div class="delivery-inputs">
                        <input type="text" id="order-fio" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ –Ü–º'—è">
                        <input type="tel" id="order-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É">
                        <input type="text" id="order-city" placeholder="–ú—ñ—Å—Ç–æ">
                        <input type="text" id="order-address" placeholder="–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ø–æ—à—Ç–∏">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="no-call">
                        <label for="no-call">üì¶ –ù–µ –¥–∑–≤–æ–Ω–∏—Ç–∏ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</label>
                    </div>

                    <label>–û–ë–ï–†–Ü–¢–¨ –ú–ï–ù–ï–î–ñ–ï–†–ê:</label>
                    <div class="selector-row">
                        <button class="sel-btn active" id="btn-rina" onclick="setManager('Rina')">RINA</button>
                        <button class="sel-btn" id="btn-misha" onclick="setManager('Misha')">MISHA</button>
                    </div>

                    <button class="cyber-btn-glitch" onclick="confirmOrder()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò –ó–ê–ú–û–í–õ–ï–ù–ù–Ø</button>
                    <button class="close-txt" onclick="closeOrder()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</button>
                </div>

                <div id="order-success" style="display:none;">
                    <i class="fas fa-check-circle success-icon"></i>
                    <h2 class="neon-txt">–ü–†–ò–ô–ù–Ø–¢–û!</h2>
                    <p>–ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∫–æ—Ä–æ –∑–≤‚Äô—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.</p>
                    <button class="cyber-btn-small" style="width:100%" onclick="closeOrder()">–ó–†–û–ó–£–ú–Ü–õ–û</button>
                </div>
            </div>
        </div>

        <div id="catalog" class="grid-container">
             <div class="system-msg">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ–≤...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCuYjKFAsKbdu_PLI4OkxiW6Wz-Yhq_q44",
            databaseURL: "https://catalog-b9cc2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "catalog-b9cc2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const productsRef = ref(db, 'laptops');
        const ordersRef = ref(db, 'orders');

        const admins = [7255848995, 921509542];
        const tg = window.Telegram.WebApp;
        const IMGBB_KEY = "70bb1de10d70f62410bc55ddd2a4fd0e";

        let currentOrder = { title: '', manager: 'Rina' };

        // –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –§–û–¢–û –ß–ï–†–ï–ó IMGBB
        document.getElementById('inp-file').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            document.getElementById('upload-status').innerHTML = '<i class="fas fa-spinner fa-spin"></i> –í–∞–Ω—Ç–∞–∂–∏–º–æ —É —Ö–º–∞—Ä—É...';
            
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: 'POST', body: formData });
                const result = await res.json();
                document.getElementById('inp-img-url').value = result.data.url;
                document.getElementById('upload-status').innerHTML = '<span style="color:#00f3ff">‚úÖ –§–æ—Ç–æ –≥–æ—Ç–æ–≤–µ –¥–æ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó</span>';
                document.getElementById('add-btn').disabled = false;
            } catch (err) { 
                document.getElementById('upload-status').innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è";
            }
        });

        // –ü–Ü–î–¢–í–ï–†–î–ñ–ï–ù–ù–Ø –ó–ê–ú–û–í–õ–ï–ù–ù–Ø
        window.confirmOrder = async () => {
            const fio = document.getElementById('order-fio').value;
            const phone = document.getElementById('order-phone').value;
            const noCall = document.getElementById('no-call').checked;

            if(!fio || !phone) return tg.showAlert("‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ!");

            await push(ordersRef, {
                ...currentOrder,
                client: fio,
                phone: phone,
                addr: document.getElementById('order-city').value + ", " + document.getElementById('order-address').value,
                noCall: noCall ? "‚úÖ –ù–µ –¥–∑–≤–æ–Ω–∏—Ç–∏" : "üìû –ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–∑–≤—ñ–Ω–æ–∫",
                user: tg.initDataUnsafe?.user?.username || 'user',
                date: new Date().toLocaleString()
            });

            document.getElementById('order-step-1').style.display = 'none';
            document.getElementById('order-success').style.display = 'block';
            tg.HapticFeedback.notificationOccurred('success');
        };

        // –õ–û–ì–Ü–ö–ê –î–û–î–ê–í–ê–ù–ù–Ø –¢–û–í–ê–†–£
        window.addProduct = async () => {
            const title = document.getElementById('inp-title').value;
            const price = document.getElementById('inp-price').value;
            const img = document.getElementById('inp-img-url').value;

            if(!title || !price || !img) return tg.showAlert("‚ö†Ô∏è –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞–Ω—ñ —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å —Ñ–æ—Ç–æ!");

            await push(productsRef, {
                title,
                price,
                specs: document.getElementById('inp-specs').value,
                type: document.getElementById('inp-type').value,
                image: img,
                date: Date.now()
            });
            
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.getElementById('upload-status').innerText = "";
            toggleAdminPanel();
            tg.showAlert("üöÄ –õ–æ—Ç –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—ñ!");
        };

        // –ö–ï–†–£–í–ê–ù–ù–Ø –¢–ê –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø
        window.toggleAdminPanel = () => document.getElementById('admin-panel').classList.toggle('open');
        window.switchTab = (t) => {
            document.querySelectorAll('.tab-btn, .tab-content').forEach(el => el.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${t}')"]`).classList.add('active');
            document.getElementById(`tab-${t}`).classList.add('active');
        };

        onValue(productsRef, (s) => {
            const catalog = document.getElementById('catalog');
            catalog.innerHTML = "";
            const data = s.val();
            if(data) Object.keys(data).reverse().forEach(k => {
                const p = data[k];
                catalog.innerHTML += `<div class="cyber-card"><div class="card-img-box"><img src="${p.image}"></div><div class="card-body"><h3>${p.title}</h3><div class="action-row"><span>${p.price} ‚Ç¥</span><button class="buy-btn" onclick="openOrder('${p.title}')">–ö–£–ü–ò–¢–ò</button></div></div></div>`;
            });
        });

        onValue(ordersRef, (s) => {
            const list = document.getElementById('orders-list');
            list.innerHTML = "";
            const data = s.val();
            if(data) Object.keys(data).reverse().forEach(k => {
                const o = data[k];
                list.innerHTML += `<div class="order-item"><b>${o.title}</b><br>üë§ ${o.client} (${o.phone})<br>üìç ${o.addr}<br>üõ∞ ${o.noCall}<br>üë®‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä: ${o.manager}<br><button class="del-order" onclick="remove(ref(db, 'orders/${k}'))">–ê–†–•–Ü–í–£–í–ê–¢–ò</button></div>`;
            });
        });

        window.openOrder = (t) => { currentOrder.title = t; document.getElementById('order-form').style.display = 'flex'; };
        window.closeOrder = () => document.getElementById('order-form').style.display = 'none';
        window.setManager = (m) => { currentOrder.manager = m; document.getElementById('btn-rina').classList.toggle('active', m==='Rina'); document.getElementById('btn-misha').classList.toggle('active', m==='Misha'); };

        if (admins.includes(tg.initDataUnsafe?.user?.id)) document.getElementById('admin-toggle').style.display = 'flex';
    </script>
</body>
</html>

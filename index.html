<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEQRA</title>

<link rel="stylesheet" href="style.css">

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<div class="app">

<header>
<h1>TEQRA</h1>
<div class="filters">
<button onclick="filterCategory('all')">–£–°–Ü</button>
<button onclick="filterCategory('gaming')">–Ü–ì–†–û–í–Ü</button>
<button onclick="filterCategory('office')">–û–§–Ü–°–ù–Ü</button>
</div>
</header>

<div id="catalog" class="catalog"></div>

</div>

<!-- –ö–Ω–æ–ø–∫–∞ –∞–¥–º—ñ–Ω–∞ -->
<button id="adminBtn" class="admin-btn">>_CMD</button>

<!-- –ê–¥–º—ñ–Ω —à—Ç–æ—Ä–∫–∞ -->
<div id="adminPanel" class="admin-panel">
<div class="panel-content">

<h2>–ê–î–ú–Ü–ù –ü–ê–ù–ï–õ–¨</h2>

<div class="tabs">
<button onclick="showTab('newLot')">–ù–û–í–ò–ô –õ–û–¢</button>
<button onclick="showTab('orders')">–ó–ê–ú–û–í–õ–ï–ù–ù–Ø</button>
</div>

<div id="newLot" class="tab">
<input id="lotTitle" placeholder="–ù–∞–∑–≤–∞">
<input id="lotPrice" placeholder="–¶—ñ–Ω–∞">
<select id="lotCategory">
<option value="gaming">–Ü–ì–†–û–í–Ü</option>
<option value="office">–û–§–Ü–°–ù–Ü</option>
</select>
<textarea id="lotSpecs" placeholder="–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏"></textarea>
<input type="file" id="lotImage">
<button onclick="uploadImage()">–û–ë–†–ê–¢–ò –§–û–¢–û –ó –ì–ê–õ–ï–†–ï–á</button>
<button onclick="addLot()">–î–û–î–ê–¢–ò</button>
</div>

<div id="orders" class="tab hidden">
<div id="ordersList"></div>
</div>

</div>
</div>

<!-- –§–æ—Ä–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
<div id="orderModal" class="modal hidden">
<div class="modal-content">
<h2>–û–§–û–†–ú–õ–ï–ù–ù–Ø</h2>
<input id="clientName" placeholder="–ü–Ü–ë">
<input id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
<input id="clientCity" placeholder="–ú—ñ—Å—Ç–æ">
<input id="clientPost" placeholder="–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ø–æ—à—Ç–∏">
<label><input type="checkbox" id="noCall"> ü§´ –ù–µ –¥–∑–≤–æ–Ω–∏—Ç–∏ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</label>

<select id="manager">
<option value="RINA">RINA</option>
<option value="MISHA">MISHA</option>
</select>

<button onclick="confirmOrder()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò</button>
</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const admins = [7255848995, 921509542];

if (!admins.includes(tg.initDataUnsafe.user?.id)) {
document.getElementById("adminBtn").style.display = "none";
}

document.getElementById("adminBtn").onclick = () => {
document.getElementById("adminPanel").classList.toggle("open");
};

document.body.addEventListener("click", (e) => {
if (!e.target.closest("input, textarea")) {
document.activeElement.blur();
}
});

const firebaseConfig = {
apiKey: "AIzaSyCuYjKFAsKbdu_PLI4OkxiW6Wz-Yhq_q44",
databaseURL: "https://catalog-b9cc2-default-rtdb.europe-west1.firebasedatabase.app",
projectId: "catalog-b9cc2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function filterCategory(cat) {
loadCatalog(cat);
}

function loadCatalog(category="all") {
db.ref("lots").on("value", snap => {
const data = snap.val();
const catalog = document.getElementById("catalog");
catalog.innerHTML = "";

if (!data) {
catalog.innerHTML = `
<div class="empty">
<div class="ghost">üëª</div>
<h2>–°–ï–ö–¢–û–† –ü–û–†–û–ñ–ù–Ü–ô</h2>
</div>`;
return;
}

Object.keys(data).forEach(id => {
const item = data[id];
if (category === "all" || item.category === category) {
catalog.innerHTML += `
<div class="card">
<img src="${item.image}">
<h3>${item.title}</h3>
<p>${item.specs}</p>
<div class="price">${item.price} ‚Ç¥</div>
<button onclick="openOrder('${id}')">–ö–£–ü–ò–¢–ò</button>
</div>`;
}
});
});
}

function uploadImage() {
const file = document.getElementById("lotImage").files[0];
const formData = new FormData();
formData.append("image", file);

fetch("https://api.imgbb.com/1/upload?key=70bb1de10d70f62410bc55ddd2a4fd0e", {
method: "POST",
body: formData
})
.then(res => res.json())
.then(data => {
window.uploadedImage = data.data.url;
});
}

function addLot() {
const lot = {
title: lotTitle.value,
price: lotPrice.value,
category: lotCategory.value,
specs: lotSpecs.value,
image: window.uploadedImage || ""
};
db.ref("lots").push(lot);
alert("–î–û–î–ê–ù–û");
}

function openOrder(id) {
window.currentLot = id;
orderModal.classList.remove("hidden");
}

function confirmOrder() {
const order = {
lot: window.currentLot,
name: clientName.value,
phone: clientPhone.value,
city: clientCity.value,
post: clientPost.value,
noCall: noCall.checked,
manager: manager.value,
status: "active"
};
db.ref("orders").push(order);
orderModal.classList.add("hidden");
alert("–ó–ê–ú–û–í–õ–ï–ù–ù–Ø –ù–ê–î–Ü–°–õ–ê–ù–û");
}

function showTab(tab) {
document.querySelectorAll(".tab").forEach(t => t.classList.add("hidden"));
document.getElementById(tab).classList.remove("hidden");
if (tab === "orders") loadOrders();
}

function loadOrders() {
db.ref("orders").on("value", snap => {
const data = snap.val();
ordersList.innerHTML = "";
if (!data) return;
Object.keys(data).forEach(id => {
const o = data[id];
ordersList.innerHTML += `
<div class="order">
<p>${o.name}</p>
<p>${o.phone}</p>
<p>${o.city}</p>
<p>${o.manager}</p>
</div>`;
});
});
}

loadCatalog();
</script>

</body>
</html>

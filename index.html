<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TEQRA Space Catalog</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <header>
        <h1 class="logo">TEQRA</h1>
        <p class="subtitle">Future Tech. Delivered.</p>
        <button id="admin-toggle-btn" class="admin-btn" style="display: none;" onclick="toggleAdminPanel()">
            ‚ö° –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è
        </button>
    </header>

    <div id="admin-dashboard" class="admin-panel-container" style="display: none;">
        <div class="admin-header">
            <h2 class="panel-title">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª–æ—Ç–∞</h2>
        </div>
        <div class="admin-form">
             <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label>–ú–æ–¥–µ–ª—å –ø—Ä–∏—Å—Ç—Ä–æ—é</label>
                    <input type="text" id="inp-title" placeholder="–ù–∞–ø—Ä: MSI Cyborg 15 A12V">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>–¶—ñ–Ω–∞ (‚Ç¥)</label>
                    <input type="number" id="inp-price" placeholder="45000">
                </div>
            </div>

            <div class="form-row">
                 <div class="form-group">
                    <label>–ö–ª–∞—Å</label>
                    <select id="inp-type">
                        <option value="gaming">üöÄ Gaming (–Ü–≥—Ä–æ–≤–∏–π)</option>
                        <option value="work">üíº Business (–†–æ–±–æ—á–∏–π)</option>
                        <option value="ultrabook">üõ∏ Ultrabook (–¢–æ–Ω–∫–∏–π)</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 2;">
                    <label>–°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (CPU / GPU / RAM)</label>
                    <input type="text" id="inp-specs" placeholder="i7-12650H / RTX 4060 / 16GB">
                </div>
            </div>

            <div class="form-group">
                <label>–§–æ—Ç–æ (–ü–æ—Å–∏–ª–∞–Ω–Ω—è)</label>
                <input type="text" id="inp-img" placeholder="https://...">
            </div>

            <button class="btn-submit" onclick="addProduct()">–ê–ö–¢–ò–í–£–í–ê–¢–ò –õ–û–¢ –í –ë–ê–ó–Ü</button>
        </div>
    </div>
    <div class="filters-container">
        <select id="filter-type" class="filter-select" onchange="renderProducts()">
            <option value="all">üí† –í—Å—ñ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∏</option>
            <option value="gaming">üöÄ Gaming Class</option>
            <option value="work">üíº Business Class</option>
            <option value="ultrabook">üõ∏ Ultrabooks</option>
        </select>
        <select id="filter-price" class="filter-select" onchange="renderProducts()">
            <option value="all">üí∞ –ë—É–¥—å-—è–∫–∏–π –±—é–¥–∂–µ—Ç</option>
            <option value="cheap">–î–æ 10k</option>
            <option value="mid">10k - 25k</option>
            <option value="expensive">–í—ñ–¥ 25k</option>
        </select>
    </div>

    <div id="catalog" class="catalog-grid">
        <div class="loading">
            <i class="fas fa-satellite-dish fa-spin"></i> –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–≤'—è–∑–∫—É –∑ –±–∞–∑–æ—é TEQRA...
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } 
        from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // === –í–°–¢–ê–í –°–Æ–î–ê –°–í–û–ô API KEY ===
        const firebaseConfig = {
            apiKey: "–í–°–¢–ê–í–¨_–°–í–û–ô_API_KEY", // <--- –¢–£–¢
            databaseURL: "https://catalog-b9cc2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "catalog-b9cc2",
            storageBucket: "catalog-b9cc2.firebasestorage.app",
            messagingSenderId: "653019820107",
            appId: "1:653019820107:web:ee51e7187c0ea8ccfbddce"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const productsRef = ref(db, 'laptops');

        // === –í–ê–®–Ü ID ===
        const admins = [
            7255848995, // –¢–∏
            921509542   // –ú—ñ—à–∞
        ];

        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#0a0a12'); // –ß–æ—Ä–Ω–∏–π –∫–æ–ª—ñ—Ä —à–∞–ø–∫–∏ –¢–µ–ª–µ–≥—Ä–∞–º
        tg.setBackgroundColor('#0a0a12');

        let isAdmin = false;

        function checkAdmin() {
            const userId = tg.initDataUnsafe?.user?.id;
            if (admins.includes(userId)) {
                isAdmin = true;
                // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –∞–¥–º—ñ–Ω–∫–∏
                document.getElementById('admin-toggle-btn').style.display = 'inline-block';
            }
        }
        checkAdmin();

        // –§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è/–∑–∞–∫—Ä–∏—Ç—Ç—è –ø–∞–Ω–µ–ª—ñ
        window.toggleAdminPanel = function() {
            const panel = document.getElementById('admin-dashboard');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                panel.scrollIntoView({ behavior: 'smooth' });
            } else {
                panel.style.display = 'none';
            }
        }

        let allProducts = [];
        onValue(productsRef, (snapshot) => {
            const data = snapshot.val();
            allProducts = [];
            if (data) {
                Object.keys(data).forEach(key => allProducts.push({ id: key, ...data[key] }));
            }
            allProducts.reverse();
            renderProducts();
        });

        window.renderProducts = function() {
            const catalog = document.getElementById('catalog');
            const typeFilter = document.getElementById('filter-type').value;
            const priceFilter = document.getElementById('filter-price').value;
            
            catalog.innerHTML = "";

            const filtered = allProducts.filter(p => {
                let matchType = (typeFilter === 'all') || (p.type === typeFilter);
                let matchPrice = true;
                const price = parseInt(p.price);
                if (priceFilter === 'cheap') matchPrice = price < 10000;
                if (priceFilter === 'mid') matchPrice = price >= 10000 && price <= 25000;
                if (priceFilter === 'expensive') matchPrice = price > 25000;
                return matchType && matchPrice;
            });

            if(filtered.length === 0) {
                catalog.innerHTML = '<div class="empty-state">–û–±\'—î–∫—Ç—ñ–≤ –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ –≤ —Ü—å–æ–º—É —Å–µ–∫—Ç–æ—Ä—ñ.</div>';
                return;
            }

            filtered.forEach(p => {
                let badgeClass = 'badge-work'; let badgeText = 'Business';
                if(p.type === 'gaming') { badgeClass = 'badge-game'; badgeText = 'Gaming Class'; }
                if(p.type === 'ultrabook') { badgeClass = 'badge-ultra'; badgeText = 'Ultrabook'; }

                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="card-image-container">
                        <img src="${p.image}" class="product-img" onerror="this.src='https://placehold.co/600x400/1a1a2e/00f3ff?text=TEQRA+Unit'">
                        <div class="card-overlay"></div>
                        <span class="badge ${badgeClass}">${badgeText}</span>
                        ${isAdmin ? `<button class="delete-btn" onclick="deleteProduct('${p.id}')"><i class="fas fa-times"></i></button>` : ''}
                    </div>
                    <div class="card-info">
                        <h3 class="product-title">${p.title}</h3>
                        <div class="specs-container">
                            <i class="fas fa-microchip"></i> <span>${p.specs}</span>
                        </div>
                        <div class="price-row">
                            <span class="price">${p.price} <small>‚Ç¥</small></span>
                            <button class="buy-btn" onclick="tg.sendData('–ó–∞–ø–∏—Ç –Ω–∞ —é–Ω—ñ—Ç: ${p.title}')">–ó–ê–ú–û–í–ò–¢–ò</button>
                        </div>
                    </div>
                `;
                catalog.appendChild(card);
            });
        }

        window.addProduct = async function() {
            const title = document.getElementById('inp-title').value;
            const specs = document.getElementById('inp-specs').value;
            const price = document.getElementById('inp-price').value;
            const type = document.getElementById('inp-type').value;
            const img = document.getElementById('inp-img').value;

            if(!title || !price) { tg.showAlert("‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ —é–Ω—ñ—Ç–∞!"); return; }

            try {
                await push(productsRef, { title, specs, price, type, image: img, date: Date.now() });
                document.querySelectorAll('.admin-form input').forEach(i => i.value = '');
                tg.showAlert("‚úÖ –Æ–Ω—ñ—Ç —É—Å–ø—ñ—à–Ω–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—ñ!");
                toggleAdminPanel(); // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –ø–∞–Ω–µ–ª—å –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è
            } catch (e) { tg.showAlert("–ü–æ–º–∏–ª–∫–∞ —Å–∏—Å—Ç–µ–º–∏: " + e.message); }
        }

        window.deleteProduct = async function(id) {
            tg.showConfirm("–î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ü–µ–π —é–Ω—ñ—Ç –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö?", async (ok) => {
                if(ok) await remove(ref(db, `laptops/${id}`));
            });
        }
    </script>
</body>
</html>

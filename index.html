<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>TEQRA OS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body onclick="hideKeyboard()">
    <div class="bg-overlay"></div>

    <div class="app-container">
        <header>
            <div class="brand-box">
                <h1 class="logo">TEQRA<span class="dot">.</span>STORE</h1>
                <div class="status-online">COMMUNICATION LINK ESTABLISHED</div>
            </div>
            <button id="admin-toggle" class="cmd-btn" style="display: none;" onclick="toggleAdminPanel(); event.stopPropagation();">
                <i class="fas fa-terminal"></i> CMD
            </button>
        </header>

        <div class="filters-bar">
            <button class="filter-btn active" onclick="setFilter('all', this)">üí† –í–°–Ü</button>
            <button class="filter-btn" onclick="setFilter('gaming', this)">üöÄ GAMING</button>
            <button class="filter-btn" onclick="setFilter('work', this)">üíº BUSINESS</button>
            <button class="filter-btn" onclick="setFilter('ultrabook', this)">üõ∏ ULTRA</button>
        </div>

        <div id="catalog" class="catalog-grid">
            <div class="loader"><i class="fas fa-sync fa-spin"></i> SCANNING BATTLESTATIONS...</div>
        </div>
    </div>

    <div id="admin-panel" class="side-panel">
        <div class="panel-blur" onclick="toggleAdminPanel()"></div>
        <div class="panel-content" onclick="event.stopPropagation()">
            <div class="panel-handle"></div>
            <div class="admin-tabs">
                <button class="tab-link active" onclick="switchTab('add')">–ù–û–í–ò–ô –õ–û–¢</button>
                <button class="tab-link" onclick="switchTab('orders')">–ó–ê–ú–û–í–õ–ï–ù–ù–Ø</button>
            </div>

            <div id="tab-add" class="tab-pane active">
                <div class="cyber-form">
                    <label>–ú–æ–¥–µ–ª—å</label>
                    <input type="text" id="inp-title" placeholder="–ù–∞–ø—Ä: MSI GF63 Thin">
                    
                    <div class="row">
                        <div style="flex:1">
                            <label>–¶—ñ–Ω–∞ ‚Ç¥</label>
                            <input type="number" id="inp-price" placeholder="18999">
                        </div>
                        <div style="flex:1">
                            <label>–¢–∏–ø</label>
                            <select id="inp-type">
                                <option value="gaming">GAMING</option>
                                <option value="work">BUSINESS</option>
                                <option value="ultrabook">ULTRA</option>
                            </select>
                        </div>
                    </div>

                    <label>–ó–∞–ª—ñ–∑–æ</label>
                    <input type="text" id="inp-specs" placeholder="i7 / RTX 4060 / 16GB">
                    
                    <input type="file" id="inp-file" accept="image/*" style="display: none;">
                    <button class="upload-trigger" onclick="document.getElementById('inp-file').click()">
                        <i class="fas fa-camera"></i> –û–ë–†–ê–¢–ò –§–û–¢–û –ó –ì–ê–õ–ï–†–ï–á
                    </button>
                    <div id="upload-status" class="status-text"></div>
                    <input type="hidden" id="inp-img-url">
                    
                    <button class="action-btn" id="add-btn" onclick="addProduct()" disabled>–ê–ö–¢–ò–í–£–í–ê–¢–ò –°–ò–°–¢–ï–ú–£</button>
                </div>
            </div>

            <div id="tab-orders" class="tab-pane">
                <div id="orders-list" class="orders-feed"></div>
            </div>
        </div>
    </div>

    <div id="order-form" class="modal-overlay" style="display:none;">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h3>–û–§–û–†–ú–õ–ï–ù–ù–Ø</h3>
            <div class="input-stack">
                <input type="text" id="order-fio" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ –Ü–º'—è">
                <input type="tel" id="order-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É">
                <input type="text" id="order-city" placeholder="–ú—ñ—Å—Ç–æ">
                <input type="text" id="order-address" placeholder="–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ø–æ—à—Ç–∏">
            </div>
            <div class="check-box">
                <input type="checkbox" id="no-call">
                <label for="no-call">üì¶ –ù–µ –¥–∑–≤–æ–Ω–∏—Ç–∏ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</label>
            </div>
            <button class="action-btn" onclick="confirmOrder()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò</button>
            <button class="cancel-link" onclick="closeOrder()">–ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCuYjKFAsKbdu_PLI4OkxiW6Wz-Yhq_q44",
            databaseURL: "https://catalog-b9cc2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "catalog-b9cc2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const productsRef = ref(db, 'laptops');
        const ordersRef = ref(db, 'orders');
        const admins = [7255848995, 921509542];
        const tg = window.Telegram.WebApp;
        const IMGBB_KEY = "70bb1de10d70f62410bc55ddd2a4fd0e";

        window.hideKeyboard = () => { if(document.activeElement) document.activeElement.blur(); };

        document.getElementById('inp-file').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            document.getElementById('upload-status').innerHTML = "‚è≥ ANALYZING IMAGE...";
            const fd = new FormData(); fd.append('image', file);
            try {
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, {method:'POST', body:fd});
                const r = await res.json();
                document.getElementById('inp-img-url').value = r.data.url;
                document.getElementById('upload-status').innerHTML = "‚úÖ READY";
                document.getElementById('add-btn').disabled = false;
            } catch { document.getElementById('upload-status').innerText = "ERROR"; }
        });

        window.toggleAdminPanel = () => { hideKeyboard(); document.getElementById('admin-panel').classList.toggle('active'); };
        window.switchTab = (t) => {
            document.querySelectorAll('.tab-link, .tab-pane').forEach(el => el.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${t}')"]`).classList.add('active');
            document.getElementById(`tab-${t}`).classList.add('active');
        };

        onValue(productsRef, (s) => {
            const catalog = document.getElementById('catalog');
            catalog.innerHTML = "";
            const data = s.val();
            if(data) Object.keys(data).reverse().forEach(k => {
                const p = data[k];
                catalog.innerHTML += `
                <div class="item-card">
                    <div class="img-wrap"><img src="${p.image}"></div>
                    <div class="item-info">
                        <h3>${p.title}</h3>
                        <p>${p.specs}</p>
                        <div class="price-row"><span class="price-val">${p.price} ‚Ç¥</span>
                        <button class="buy-button" onclick="openOrder('${p.title}')">–ö–£–ü–ò–¢–ò</button></div>
                    </div>
                </div>`;
            });
        });

        window.confirmOrder = async () => {
            hideKeyboard();
            const fio = document.getElementById('order-fio').value;
            const phone = document.getElementById('order-phone').value;
            if(!fio || !phone) return tg.showAlert("–í–ö–ê–ñ–Ü–¢–¨ –î–ê–ù–Ü");
            await push(ordersRef, {
                title: window.targetTitle, client: fio, phone: phone,
                addr: document.getElementById('order-city').value + " " + document.getElementById('order-address').value,
                noCall: document.getElementById('no-call').checked,
                user: tg.initDataUnsafe?.user?.username || 'user',
                date: new Date().toLocaleString()
            });
            tg.showAlert("–°–ò–°–¢–ï–ú–ê –ü–†–ò–ô–ù–Ø–õ–ê –ó–ê–ú–û–í–õ–ï–ù–ù–Ø");
            closeOrder();
        };

        window.addProduct = async () => {
            hideKeyboard();
            const title = document.getElementById('inp-title').value;
            const price = document.getElementById('inp-price').value;
            const img = document.getElementById('inp-img-url').value;
            if(!title || !price || !img) return;
            await push(productsRef, { title, price, specs: document.getElementById('inp-specs').value, type: document.getElementById('inp-type').value, image: img, date: Date.now() });
            document.querySelectorAll('input').forEach(i => i.value = '');
            toggleAdminPanel();
        };

        window.openOrder = (t) => { window.targetTitle = t; document.getElementById('order-form').style.display = 'flex'; };
        window.closeOrder = () => document.getElementById('order-form').style.display = 'none';

        if (admins.includes(tg.initDataUnsafe?.user?.id)) document.getElementById('admin-toggle').style.display = 'flex';
    </script>
</body>
</html>
